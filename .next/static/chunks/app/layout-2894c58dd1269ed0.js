(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{2545:(e,a,t)=>{"use strict";t.d(a,{AuthProvider:()=>u,A:()=>l});var r=t(5155),n=t(2115),s=t(7559);let o=()=>(0,s.createBrowserClient)("https://temp.supabase.co","temp-key");o();let i=(0,n.createContext)(null);function l(){let e=(0,n.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}function u(e){let{children:a}=e,[t,s]=(0,n.useState)(null),[l,u]=(0,n.useState)(null),[d,c]=(0,n.useState)(null),[g,m]=(0,n.useState)(!0),h=o(),_=async e=>{if(!e){s(null),c(null),m(!1);return}try{let{data:a,error:t}=await h.from("users").select("\n          *,\n          organization:organizations(*)\n        ").eq("id",e.id).single();if(t){console.error("Error loading user data:",t),m(!1);return}if(!a)return void m(!1);let r=a.organization?[{id:a.organization.id,name:a.organization.name,slug:a.organization.slug,role:a.role,is_active:!0}]:[],n=a.organization||null,o={...a,organizations:r,current_organization:n};s(o),c(n),u(e),n&&localStorage.setItem("current_organization_id",n.id)}catch(e){console.error("Error in loadUserData:",e)}finally{m(!1)}};(0,n.useEffect)(()=>{(async()=>{let{data:{session:e}}=await h.auth.getSession();await _((null==e?void 0:e.user)||null)})();let{data:{subscription:e}}=h.auth.onAuthStateChange(async(e,a)=>{"SIGNED_IN"===e||"TOKEN_REFRESHED"===e?await _((null==a?void 0:a.user)||null):"SIGNED_OUT"===e&&(s(null),u(null),c(null),localStorage.removeItem("current_organization_id"),m(!1))});return()=>{e.unsubscribe()}},[]);let f=async(e,a)=>{let{error:t}=await h.auth.signInWithPassword({email:e,password:a});return{error:t}},p=async()=>{let{error:e}=await h.auth.signOut();e&&console.error("Error signing out:",e)},w=async(e,a,t)=>{let{error:r}=await h.auth.signUp({email:e,password:a,options:{data:t}});return{error:r}},v=async e=>{var a;if(!t)return;if(!(null==(a=t.organizations)?void 0:a.find(a=>a.id===e)))throw Error("Organization not found in user organizations");let{error:r}=await h.from("users").update({organization_id:e}).eq("id",t.id);if(r)throw console.error("Error switching organization:",r),r;await b()},b=async()=>{l&&await _(l)},y=(null==t?void 0:t.role)==="owner",z=(null==t?void 0:t.is_admin)===!0||y,E=(null==t?void 0:t.role)||null,S=(null==t?void 0:t.organizations)||[];return(0,r.jsx)(i.Provider,{value:{user:t,supabaseUser:l,currentOrganization:d,currentRole:E,organizations:S,loading:g,signIn:f,signOut:p,signUp:w,switchOrganization:v,refreshUser:b,hasPermission:(e,a)=>{if(!t||!t.role)return!1;if("owner"===t.role)return!0;let r={owner:["*"],operations_manager:["users:create","users:read","users:update","contacts:create","contacts:read","contacts:update","leads:read","leads:update","jobs:read","jobs:update","estimates:read"],sales_manager:["contacts:create","contacts:read","contacts:update","leads:create","leads:read","leads:update","jobs:read","estimates:read"],estimating_manager:["contacts:read","leads:read","leads:update","jobs:read","estimates:create","estimates:read","estimates:update"],estimator:["contacts:read","leads:read","leads:update","estimates:create","estimates:read","estimates:update"],field_management:["contacts:read","jobs:read","jobs:update"]}[t.role]||[],n="".concat(e,":").concat(a);return r.includes("*")||r.includes(n)},hasRole:e=>!!t&&!!t.role&&(Array.isArray(e)?e:[e]).includes(t.role),isOwner:y,isAdmin:z},children:a})}},3673:()=>{},5939:(e,a,t)=>{Promise.resolve().then(t.t.bind(t,8963,23)),Promise.resolve().then(t.t.bind(t,3673,23)),Promise.resolve().then(t.bind(t,2545))},8963:e=>{e.exports={style:{fontFamily:"'Inter', 'Inter Fallback'",fontStyle:"normal"},className:"__className_e8ce0c"}}},e=>{e.O(0,[300,559,441,255,358],()=>e(e.s=5939)),_N_E=e.O()}]);