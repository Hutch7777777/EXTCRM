(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[72],{63:(e,r,t)=>{"use strict";var a=t(7260);t.o(a,"usePathname")&&t.d(r,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}})},2538:(e,r,t)=>{Promise.resolve().then(t.bind(t,4423))},2545:(e,r,t)=>{"use strict";t.d(r,{AuthProvider:()=>d,A:()=>l});var a=t(5155),s=t(2115),n=t(7559);let o=()=>(0,n.createBrowserClient)("https://temp.supabase.co","temp-key");o();let i=(0,s.createContext)(null);function l(){let e=(0,s.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}function d(e){let{children:r}=e,[t,n]=(0,s.useState)(null),[l,d]=(0,s.useState)(null),[u,c]=(0,s.useState)(null),[f,m]=(0,s.useState)(!0),g=o(),p=async e=>{if(!e){n(null),c(null),m(!1);return}try{let{data:r,error:t}=await g.from("users").select("\n          *,\n          organization:organizations(*)\n        ").eq("id",e.id).single();if(t){console.error("Error loading user data:",t),m(!1);return}if(!r)return void m(!1);let a=r.organization?[{id:r.organization.id,name:r.organization.name,slug:r.organization.slug,role:r.role,is_active:!0}]:[],s=r.organization||null,o={...r,organizations:a,current_organization:s};n(o),c(s),d(e),s&&localStorage.setItem("current_organization_id",s.id)}catch(e){console.error("Error in loadUserData:",e)}finally{m(!1)}};(0,s.useEffect)(()=>{(async()=>{let{data:{session:e}}=await g.auth.getSession();await p((null==e?void 0:e.user)||null)})();let{data:{subscription:e}}=g.auth.onAuthStateChange(async(e,r)=>{"SIGNED_IN"===e||"TOKEN_REFRESHED"===e?await p((null==r?void 0:r.user)||null):"SIGNED_OUT"===e&&(n(null),d(null),c(null),localStorage.removeItem("current_organization_id"),m(!1))});return()=>{e.unsubscribe()}},[]);let h=async(e,r)=>{let{error:t}=await g.auth.signInWithPassword({email:e,password:r});return{error:t}},x=async()=>{let{error:e}=await g.auth.signOut();e&&console.error("Error signing out:",e)},b=async(e,r,t)=>{let{error:a}=await g.auth.signUp({email:e,password:r,options:{data:t}});return{error:a}},v=async e=>{var r;if(!t)return;if(!(null==(r=t.organizations)?void 0:r.find(r=>r.id===e)))throw Error("Organization not found in user organizations");let{error:a}=await g.from("users").update({organization_id:e}).eq("id",t.id);if(a)throw console.error("Error switching organization:",a),a;await y()},y=async()=>{l&&await p(l)},w=(null==t?void 0:t.role)==="owner",N=(null==t?void 0:t.is_admin)===!0||w,j=(null==t?void 0:t.role)||null,_=(null==t?void 0:t.organizations)||[];return(0,a.jsx)(i.Provider,{value:{user:t,supabaseUser:l,currentOrganization:u,currentRole:j,organizations:_,loading:f,signIn:h,signOut:x,signUp:b,switchOrganization:v,refreshUser:y,hasPermission:(e,r)=>{if(!t||!t.role)return!1;if("owner"===t.role)return!0;let a={owner:["*"],operations_manager:["users:create","users:read","users:update","contacts:create","contacts:read","contacts:update","leads:read","leads:update","jobs:read","jobs:update","estimates:read"],sales_manager:["contacts:create","contacts:read","contacts:update","leads:create","leads:read","leads:update","jobs:read","estimates:read"],estimating_manager:["contacts:read","leads:read","leads:update","jobs:read","estimates:create","estimates:read","estimates:update"],estimator:["contacts:read","leads:read","leads:update","estimates:create","estimates:read","estimates:update"],field_management:["contacts:read","jobs:read","jobs:update"]}[t.role]||[],s="".concat(e,":").concat(r);return a.includes("*")||a.includes(s)},hasRole:e=>!!t&&!!t.role&&(Array.isArray(e)?e:[e]).includes(t.role),isOwner:w,isAdmin:N},children:r})}},3998:(e,r,t)=>{"use strict";t.d(r,{$:()=>d});var a=t(5155),s=t(2115),n=t(6673),o=t(3101),i=t(4269);let l=(0,o.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=s.forwardRef((e,r)=>{let{className:t,variant:s,size:o,asChild:d=!1,...u}=e,c=d?n.DX:"button";return(0,a.jsx)(c,{className:(0,i.cn)(l({variant:s,size:o,className:t})),ref:r,...u})});d.displayName="Button"},4269:(e,r,t)=>{"use strict";t.d(r,{cn:()=>n});var a=t(2821),s=t(5889);function n(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,s.QP)((0,a.$)(r))}},4423:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>f});var a=t(5155),s=t(2115),n=t(63),o=t(2619),i=t.n(o),l=t(2545),d=t(3998),u=t(5142),c=t(6948);function f(){let[e,r]=(0,s.useState)(""),[t,o]=(0,s.useState)(""),[f,m]=(0,s.useState)(!1),[g,p]=(0,s.useState)(null),{signIn:h}=(0,l.A)(),x=(0,n.useRouter)(),b=async r=>{r.preventDefault(),p(null),m(!0);try{let{error:r}=await h(e,t);r?p(r.message):(x.push("/dashboard"),x.refresh())}catch(e){p("An unexpected error occurred")}finally{m(!1)}};return(0,a.jsxs)(c.Zp,{className:"w-full",children:[(0,a.jsxs)(c.aR,{className:"space-y-1",children:[(0,a.jsx)(c.ZB,{className:"text-2xl font-bold",children:"Sign In"}),(0,a.jsx)(c.BT,{children:"Enter your email and password to access your account"})]}),(0,a.jsxs)("form",{onSubmit:b,children:[(0,a.jsxs)(c.Wu,{className:"space-y-4",children:[g&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:(0,a.jsx)("p",{className:"text-sm text-red-600",children:g})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{htmlFor:"email",className:"text-sm font-medium text-gray-700",children:"Email Address"}),(0,a.jsx)(u.p,{id:"email",type:"email",placeholder:"Enter your email",value:e,onChange:e=>r(e.target.value),required:!0,disabled:f})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{htmlFor:"password",className:"text-sm font-medium text-gray-700",children:"Password"}),(0,a.jsx)(u.p,{id:"password",type:"password",placeholder:"Enter your password",value:t,onChange:e=>o(e.target.value),required:!0,disabled:f})]})]}),(0,a.jsxs)(c.wL,{className:"flex flex-col space-y-4",children:[(0,a.jsx)(d.$,{type:"submit",className:"w-full",disabled:f,children:f?"Signing In...":"Sign In"}),(0,a.jsx)("div",{className:"text-center text-sm",children:(0,a.jsx)(i(),{href:"/auth/forgot-password",className:"text-blue-600 hover:text-blue-800",children:"Forgot your password?"})}),(0,a.jsxs)("div",{className:"text-center text-sm text-gray-600",children:["Don't have an account?"," ",(0,a.jsx)(i(),{href:"/auth/signup",className:"text-blue-600 hover:text-blue-800 font-medium",children:"Sign up"})]})]})]})]})}},5142:(e,r,t)=>{"use strict";t.d(r,{p:()=>o});var a=t(5155),s=t(2115),n=t(4269);let o=s.forwardRef((e,r)=>{let{className:t,type:s,...o}=e;return(0,a.jsx)("input",{type:s,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...o})});o.displayName="Input"},6948:(e,r,t)=>{"use strict";t.d(r,{BT:()=>d,Wu:()=>u,ZB:()=>l,Zp:()=>o,aR:()=>i,wL:()=>c});var a=t(5155),s=t(2115),n=t(4269);let o=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...s})});o.displayName="Card";let i=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",t),...s})});i.displayName="CardHeader";let l=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("h3",{ref:r,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",t),...s})});l.displayName="CardTitle";let d=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("p",{ref:r,className:(0,n.cn)("text-sm text-muted-foreground",t),...s})});d.displayName="CardDescription";let u=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("p-6 pt-0",t),...s})});u.displayName="CardContent";let c=s.forwardRef((e,r)=>{let{className:t,...s}=e;return(0,a.jsx)("div",{ref:r,className:(0,n.cn)("flex items-center p-6 pt-0",t),...s})});c.displayName="CardFooter"}},e=>{e.O(0,[619,559,125,441,255,358],()=>e(e.s=2538)),_N_E=e.O()}]);