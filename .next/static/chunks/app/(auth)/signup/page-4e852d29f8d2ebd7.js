(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[271],{63:(e,a,r)=>{"use strict";var t=r(7260);r.o(t,"usePathname")&&r.d(a,{usePathname:function(){return t.usePathname}}),r.o(t,"useRouter")&&r.d(a,{useRouter:function(){return t.useRouter}})},2545:(e,a,r)=>{"use strict";r.d(a,{AuthProvider:()=>d,A:()=>l});var t=r(5155),s=r(2115),n=r(7559);let i=()=>(0,n.createBrowserClient)("https://temp.supabase.co","temp-key");i();let o=(0,s.createContext)(null);function l(){let e=(0,s.useContext)(o);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}function d(e){let{children:a}=e,[r,n]=(0,s.useState)(null),[l,d]=(0,s.useState)(null),[u,c]=(0,s.useState)(null),[m,f]=(0,s.useState)(!0),g=i(),p=async e=>{if(!e){n(null),c(null),f(!1);return}try{let{data:a,error:r}=await g.from("users").select("\n          *,\n          organization:organizations(*)\n        ").eq("id",e.id).single();if(r){console.error("Error loading user data:",r),f(!1);return}if(!a)return void f(!1);let t=a.organization?[{id:a.organization.id,name:a.organization.name,slug:a.organization.slug,role:a.role,is_active:!0}]:[],s=a.organization||null,i={...a,organizations:t,current_organization:s};n(i),c(s),d(e),s&&localStorage.setItem("current_organization_id",s.id)}catch(e){console.error("Error in loadUserData:",e)}finally{f(!1)}};(0,s.useEffect)(()=>{(async()=>{let{data:{session:e}}=await g.auth.getSession();await p((null==e?void 0:e.user)||null)})();let{data:{subscription:e}}=g.auth.onAuthStateChange(async(e,a)=>{"SIGNED_IN"===e||"TOKEN_REFRESHED"===e?await p((null==a?void 0:a.user)||null):"SIGNED_OUT"===e&&(n(null),d(null),c(null),localStorage.removeItem("current_organization_id"),f(!1))});return()=>{e.unsubscribe()}},[]);let h=async(e,a)=>{let{error:r}=await g.auth.signInWithPassword({email:e,password:a});return{error:r}},x=async()=>{let{error:e}=await g.auth.signOut();e&&console.error("Error signing out:",e)},v=async(e,a,r)=>{let{error:t}=await g.auth.signUp({email:e,password:a,options:{data:r}});return{error:t}},b=async e=>{var a;if(!r)return;if(!(null==(a=r.organizations)?void 0:a.find(a=>a.id===e)))throw Error("Organization not found in user organizations");let{error:t}=await g.from("users").update({organization_id:e}).eq("id",r.id);if(t)throw console.error("Error switching organization:",t),t;await N()},N=async()=>{l&&await p(l)},y=(null==r?void 0:r.role)==="owner",w=(null==r?void 0:r.is_admin)===!0||y,j=(null==r?void 0:r.role)||null,C=(null==r?void 0:r.organizations)||[];return(0,t.jsx)(o.Provider,{value:{user:r,supabaseUser:l,currentOrganization:u,currentRole:j,organizations:C,loading:m,signIn:h,signOut:x,signUp:v,switchOrganization:b,refreshUser:N,hasPermission:(e,a)=>{if(!r||!r.role)return!1;if("owner"===r.role)return!0;let t={owner:["*"],operations_manager:["users:create","users:read","users:update","contacts:create","contacts:read","contacts:update","leads:read","leads:update","jobs:read","jobs:update","estimates:read"],sales_manager:["contacts:create","contacts:read","contacts:update","leads:create","leads:read","leads:update","jobs:read","estimates:read"],estimating_manager:["contacts:read","leads:read","leads:update","jobs:read","estimates:create","estimates:read","estimates:update"],estimator:["contacts:read","leads:read","leads:update","estimates:create","estimates:read","estimates:update"],field_management:["contacts:read","jobs:read","jobs:update"]}[r.role]||[],s="".concat(e,":").concat(a);return t.includes("*")||t.includes(s)},hasRole:e=>!!r&&!!r.role&&(Array.isArray(e)?e:[e]).includes(r.role),isOwner:y,isAdmin:w},children:a})}},3672:(e,a,r)=>{Promise.resolve().then(r.bind(r,8745))},3998:(e,a,r)=>{"use strict";r.d(a,{$:()=>d});var t=r(5155),s=r(2115),n=r(6673),i=r(3101),o=r(4269);let l=(0,i.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=s.forwardRef((e,a)=>{let{className:r,variant:s,size:i,asChild:d=!1,...u}=e,c=d?n.DX:"button";return(0,t.jsx)(c,{className:(0,o.cn)(l({variant:s,size:i,className:r})),ref:a,...u})});d.displayName="Button"},4269:(e,a,r)=>{"use strict";r.d(a,{cn:()=>n});var t=r(2821),s=r(5889);function n(){for(var e=arguments.length,a=Array(e),r=0;r<e;r++)a[r]=arguments[r];return(0,s.QP)((0,t.$)(a))}},5142:(e,a,r)=>{"use strict";r.d(a,{p:()=>i});var t=r(5155),s=r(2115),n=r(4269);let i=s.forwardRef((e,a)=>{let{className:r,type:s,...i}=e;return(0,t.jsx)("input",{type:s,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:a,...i})});i.displayName="Input"},6948:(e,a,r)=>{"use strict";r.d(a,{BT:()=>d,Wu:()=>u,ZB:()=>l,Zp:()=>i,aR:()=>o,wL:()=>c});var t=r(5155),s=r(2115),n=r(4269);let i=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("div",{ref:a,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})});i.displayName="Card";let o=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("div",{ref:a,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...s})});o.displayName="CardHeader";let l=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("h3",{ref:a,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});l.displayName="CardTitle";let d=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("p",{ref:a,className:(0,n.cn)("text-sm text-muted-foreground",r),...s})});d.displayName="CardDescription";let u=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("div",{ref:a,className:(0,n.cn)("p-6 pt-0",r),...s})});u.displayName="CardContent";let c=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("div",{ref:a,className:(0,n.cn)("flex items-center p-6 pt-0",r),...s})});c.displayName="CardFooter"},8745:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>m});var t=r(5155),s=r(2115),n=r(63),i=r(2619),o=r.n(i),l=r(2545),d=r(3998),u=r(5142),c=r(6948);function m(){let[e,a]=(0,s.useState)({email:"",password:"",confirmPassword:"",firstName:"",lastName:"",organizationName:""}),[r,i]=(0,s.useState)(!1),[m,f]=(0,s.useState)(null),{signUp:g}=(0,l.A)(),p=(0,n.useRouter)(),h=(e,r)=>{a(a=>({...a,[e]:r}))},x=async a=>{if(a.preventDefault(),f(null),e.password!==e.confirmPassword)return void f("Passwords do not match");if(e.password.length<6)return void f("Password must be at least 6 characters long");i(!0);try{let{error:a}=await g(e.email,e.password,{first_name:e.firstName,last_name:e.lastName,organization_name:e.organizationName});a?f(a.message):p.push("/auth/verify-email")}catch(e){f("An unexpected error occurred")}finally{i(!1)}};return(0,t.jsxs)(c.Zp,{className:"w-full",children:[(0,t.jsxs)(c.aR,{className:"space-y-1",children:[(0,t.jsx)(c.ZB,{className:"text-2xl font-bold",children:"Create Account"}),(0,t.jsx)(c.BT,{children:"Sign up to get started with EXTCRM"})]}),(0,t.jsxs)("form",{onSubmit:x,children:[(0,t.jsxs)(c.Wu,{className:"space-y-4",children:[m&&(0,t.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:(0,t.jsx)("p",{className:"text-sm text-red-600",children:m})}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{htmlFor:"firstName",className:"text-sm font-medium text-gray-700",children:"First Name"}),(0,t.jsx)(u.p,{id:"firstName",type:"text",placeholder:"John",value:e.firstName,onChange:e=>h("firstName",e.target.value),required:!0,disabled:r})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{htmlFor:"lastName",className:"text-sm font-medium text-gray-700",children:"Last Name"}),(0,t.jsx)(u.p,{id:"lastName",type:"text",placeholder:"Doe",value:e.lastName,onChange:e=>h("lastName",e.target.value),required:!0,disabled:r})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{htmlFor:"organizationName",className:"text-sm font-medium text-gray-700",children:"Company Name"}),(0,t.jsx)(u.p,{id:"organizationName",type:"text",placeholder:"Acme Construction",value:e.organizationName,onChange:e=>h("organizationName",e.target.value),disabled:r})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{htmlFor:"email",className:"text-sm font-medium text-gray-700",children:"Email Address"}),(0,t.jsx)(u.p,{id:"email",type:"email",placeholder:"john@example.com",value:e.email,onChange:e=>h("email",e.target.value),required:!0,disabled:r})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{htmlFor:"password",className:"text-sm font-medium text-gray-700",children:"Password"}),(0,t.jsx)(u.p,{id:"password",type:"password",placeholder:"Enter password",value:e.password,onChange:e=>h("password",e.target.value),required:!0,disabled:r})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{htmlFor:"confirmPassword",className:"text-sm font-medium text-gray-700",children:"Confirm Password"}),(0,t.jsx)(u.p,{id:"confirmPassword",type:"password",placeholder:"Confirm password",value:e.confirmPassword,onChange:e=>h("confirmPassword",e.target.value),required:!0,disabled:r})]})]}),(0,t.jsxs)(c.wL,{className:"flex flex-col space-y-4",children:[(0,t.jsx)(d.$,{type:"submit",className:"w-full",disabled:r,children:r?"Creating Account...":"Create Account"}),(0,t.jsxs)("div",{className:"text-center text-sm text-gray-600",children:["Already have an account?"," ",(0,t.jsx)(o(),{href:"/auth/login",className:"text-blue-600 hover:text-blue-800 font-medium",children:"Sign in"})]})]})]})]})}}},e=>{e.O(0,[619,559,125,441,255,358],()=>e(e.s=3672)),_N_E=e.O()}]);